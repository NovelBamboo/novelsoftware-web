<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BarrierCard — XHTML + Rivets.js</title>
    <style type="text/css">
      /* =====================
         Tokens & Defaults
      ===================== */
      :root {
        --font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        --h2-size: 1.25rem; /* 20px */
        --body-size: 1rem;  /* 16px */
        --padding: 1rem;    /* 16px */
        --gap: 1.5rem;      /* 24px */
        --radius: 0.5rem;   /* 8px */
        --shadow: 0 2px 6px rgba(0,0,0,0.15);
        --hover-dur: 200ms;
        --hover-ease: ease-in-out;
        --focus: #ffd166; /* high-visibility focus ring */

        /* text/background tokens are set by tone classes below */
        --bg: #0B3D91;
        --text: #ffffff;
      }

      /* Light/Dark (prefers-color-scheme) */
      @media (prefers-color-scheme: dark) {
        :root {
          /* keep strong contrast in dark too */
          --text: #ffffff;
        }
      }

      /* =====================
         Section & List Layout
      ===================== */
      body { margin: 0; font-family: var(--font-family); }
      section { padding: 1.25rem; }
      h1 { font-size: 1.5rem; line-height: 1.3; margin: 0 0 1rem 0; }

      .card-list { 
        list-style: none; 
        margin: 0; 
        padding: 0; 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem; 
      }

      /* =====================
         Card Styles
      ===================== */
      li.card { max-width: 350px; }

      .card-link { display: block; text-decoration: none; color: inherit; }
      .card-link:focus-visible { outline: 4px solid var(--focus); outline-offset: 4px; }

      .card__inner {
        background-color: var(--bg);
        color: var(--text);
        padding: var(--padding);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        transition: transform var(--hover-dur) var(--hover-ease), opacity var(--hover-dur) var(--hover-ease);
        display: flex; 
        align-items: flex-start; 
        gap: var(--gap);
      }
      li.card:hover .card__inner { transform: translateY(-2px); }

      .card__icon { inline-size: 24px; block-size: 24px; flex: 0 0 auto; margin-inline-end: var(--gap); }
      [dir="rtl"] .card__icon { margin-inline-end: 0; margin-inline-start: var(--gap); transform: scaleX(-1); }

      .card__title { 
        font-size: var(--h2-size); 
        line-height: 1.3; 
        margin: 0 0 0.5rem 0; 
        font-family: var(--font-family);
      }
      .card__body { 
        font-size: var(--body-size); 
        line-height: 1.6; 
        margin: 0;
        font-family: var(--font-family);
        word-wrap: break-word; 
        overflow-wrap: anywhere; 
      }

      /* Tone classes (ensure ≥4.5:1 contrast) */
      li.card.tone-neutral .card__inner { --bg: #0B3D91; --text: #FFFFFF; }
      li.card.tone-info    .card__inner { --bg: #1D4ED8; --text: #FFFFFF; }
      li.card.tone-warn    .card__inner { --bg: #B45309; --text: #FFFFFF; }

      /* Optional: reduce motion */
      @media (prefers-reduced-motion: reduce) {
        .card__inner { transition: none; }
      }
    </style>
  </head>
  <body>
    <section id="barrier-cards" aria-labelledby="barrier-cards-title">
      <h1 id="barrier-cards-title">Why Software Doesn’t Get Built</h1>

      <!-- BarrierCards list (3-up grid, responsive) -->
      <ul class="card-list" role="list" rv-each-item="cards">
        <li class="card tone-neutral" role="listitem"
            rv-class-tone-neutral="item.tone | eq 'neutral'"
            rv-class-tone-info="item.tone | eq 'info'"
            rv-class-tone-warn="item.tone | eq 'warn'">
          <!-- When interactive, wrap inner with a link/button so focus ring is visible -->
          <a class="card-link" href="#" rv-unless="interactiveDisabled">
            <div class="card__inner">
              <svg class="card__icon" aria-hidden="true" rv-if="item.leadingIcon" xmlns:xlink="http://www.w3.org/1999/xlink">
                <use rv-attr-xlink:href="item.leadingIcon | iconHref" />
              </svg>
              <div class="card__content">
                <h2 class="card__title" rv-text="item.title | orTbd 'title'" />
                <p class="card__body" rv-text="item.body  | orTbd 'body'" />
              </div>
            </div>
          </a>
        </li>
      </ul>
    </section>

    <!-- Inline SVG sprite (sample icons) -->
    <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute;width:0;height:0;overflow:hidden;">
      <symbol id="shield-alert" viewBox="0 0 24 24">
        <path d="M12 2l7 3v6c0 5-3.5 9.74-7 11-3.5-1.26-7-6-7-11V5l7-3zm0 4l-5 2v3c0 3.64 2.6 7.5 5 8.7 2.4-1.2 5-5.06 5-8.7V8l-5-2zm1 3v4h-2V9h2zm0 6v2h-2v-2h2z" />
      </symbol>
      <symbol id="wrench" viewBox="0 0 24 24">
        <path d="M22 7.46a5.5 5.5 0 0 1-7.46 7.46L7.41 22l-3.54-3.54 7.13-7.13A5.5 5.5 0 0 1 22 7.46zM6 19.17l.83.83.71-.71-.83-.83-.71.71z" />
      </symbol>
      <symbol id="message-x" viewBox="0 0 24 24">
        <path d="M20 2H4a2 2 0 0 0-2 2v14l4-4h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zM9.41 7L8 8.41 9.59 10 8 11.59 9.41 13 11 11.41 12.59 13 14 11.59 12.41 10 14 8.41 12.59 7 11 8.59 9.41 7z" />
      </symbol>
    </svg>

    <!-- Data (JSON) provided at build-time or embedded on page -->
    <script type="application/json" id="barrier-data">[
      { "id": "barrier:intimidation",       "title": "Intimidation",        "body": "Folks are intimidated by tech jargon, burned by off-the-shelf software, fearful of wasting money on sketchy promises.", "tone": "neutral", "leadingIcon": "shield-alert" },
      { "id": "barrier:technical-hurdles", "title": "Technical Hurdles",   "body": "Great software ideas die every day. Brilliant ideas for communities, businesses, and internal processes are forgotten because of technical hurdles.", "tone": "neutral", "leadingIcon": "wrench" },
      { "id": "barrier:poor-communication","title": "Poor Communication",   "body": "Costly agencies and developers who struggle to understand the vision or translate it into software.", "tone": "neutral", "leadingIcon": "message-x" }
    ]</script>

    <!-- Rivets.js (prefer bundling locally; path shown as example). No inline handlers anywhere. -->
    <script type="text/javascript" src="/scripts/rivets.min.js"></script>

    <!-- Component binder & helpers (no network calls) -->
    <script type="text/javascript">
      (function () {
        'use strict';

        var DEV = true; // dev-only logs for placeholder rendering

        function orTbd(value, field, id) {
          if (typeof value !== 'string' || value.replace(/\s+/g, '') === '') {
            if (DEV && typeof console !== 'undefined') {
              console.warn('[BarrierCard] Missing ' + field + ' for id=' + (id || 'unknown') + '; rendering "TBD".');
            }
            return 'TBD';
          }
          return value;
        }

        // Read JSON data
        var dataEl = document.getElementById('barrier-data');
        var cards = [];
        try {
          cards = JSON.parse(dataEl.textContent || '[]');
        } catch (e) {
          if (DEV && typeof console !== 'undefined') console.error('[BarrierCard] Failed to parse JSON:', e);
        }

        // Rivets formatters
        if (window.rivets) {
          rivets.formatters.eq = function (a, b) { return a === b; };
          rivets.formatters.iconHref = function (id) { return id ? ('#' + id) : ''; };
          rivets.formatters.orTbd = function (val, field) { return orTbd(val, field); };
        }

        var model = {
          cards: cards,
          interactiveDisabled: false
        };

        // Bind if Rivets is present; otherwise, render a static fallback (no dependencies)
        var mount = document.getElementById('barrier-cards');
        if (window.rivets && mount) {
          rivets.bind(mount, model);
        } else {
          // Minimal static renderer as fallback (does not require Rivets)
          if (DEV && typeof console !== 'undefined') console.warn('[BarrierCard] Rivets not found; using static fallback renderer.');
          var list = mount ? mount.querySelector('.card-list') : null;
          if (!list) return;

          // clear template li inserted for binding
          while (list.firstChild) { list.removeChild(list.firstChild); }

          for (var i = 0; i < cards.length; i++) {
            var item = cards[i];
            var li = document.createElement('li');
            li.setAttribute('class', 'card tone-' + (item.tone || 'neutral'));
            li.setAttribute('role', 'listitem');

            var a = document.createElement('a');
            a.setAttribute('class', 'card-link');
            a.setAttribute('href', '#');

            var inner = document.createElement('div');
            inner.setAttribute('class', 'card__inner');

            if (item.leadingIcon) {
              var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
              svg.setAttribute('class', 'card__icon');
              svg.setAttribute('aria-hidden', 'true');
              var use = document.createElementNS('http://www.w3.org/2000/svg', 'use');
              use.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', '#' + item.leadingIcon);
              svg.appendChild(use);
              inner.appendChild(svg);
            }

            var content = document.createElement('div');
            content.setAttribute('class', 'card__content');

            var h2 = document.createElement('h2');
            h2.setAttribute('class', 'card__title');
            h2.appendChild(document.createTextNode(orTbd(item.title, 'title', item.id)));

            var p = document.createElement('p');
            p.setAttribute('class', 'card__body');
            p.appendChild(document.createTextNode(orTbd(item.body, 'body', item.id)));

            content.appendChild(h2);
            content.appendChild(p);
            inner.appendChild(content);
            a.appendChild(inner);
            li.appendChild(a);
            list.appendChild(li);
          }
        }

        // Optional telemetry stub (container can toggle this on)
        var telemetryEnabled = false;
        function emit(eventName, payload) {
          if (!telemetryEnabled) return;
          try { console.log('[telemetry]', eventName, payload); } catch (e) {}
        }

        if (telemetryEnabled && 'IntersectionObserver' in window) {
          var observer = new IntersectionObserver(function (entries) {
            for (var i = 0; i < entries.length; i++) {
              var entry = entries[i];
              if (entry.isIntersecting) {
                var id = entry.target.getAttribute('data-id') || 'unknown';
                emit('barrier_card.viewed', { id: id, timestamp: new Date().toISOString() });
                observer.unobserve(entry.target);
              }
            }
          }, { threshold: 0.5 });

          var cardsEls = document.querySelectorAll('li.card');
          for (var j = 0; j < cardsEls.length; j++) observer.observe(cardsEls[j]);
        }
      })();
    </script>
  </body>
</html>
